<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ­Ù„ÙŠÙ„Ø§Øª Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª - ERPNext</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f8f9fa;
            direction: rtl;
            color: #333;
            padding: 20px;
        }

        .dashboard-header {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
        }

        .dashboard-header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .top-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            text-align: center;
            border-top: 4px solid #ff4444;
        }

        .metric-card:nth-child(2) { border-top-color: #28a745; }
        .metric-card:nth-child(3) { border-top-color: #ffc107; }
        .metric-card:nth-child(4) { border-top-color: #17a2b8; }

        .metric-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }

        .metric-value {
            font-size: 2.2rem;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .metric-label {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
        }

        .metric-change {
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 15px;
            font-weight: 500;
        }

        .positive { background: #d4edda; color: #155724; }
        .negative { background: #f8d7da; color: #721c24; }

        .charts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 30px;
        }

        .chart-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .chart-title {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 20px;
            color: #2c3e50;
            text-align: center;
        }

        .full-width-chart {
            grid-column: 1 / -1;
        }

        .performance-indicators {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .indicator-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }

        .indicator-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #ff4444;
            margin-bottom: 5px;
        }

        .indicator-label {
            font-size: 14px;
            color: #666;
        }

        .sales-table {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            overflow-x: auto;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th,
        .table td {
            padding: 12px;
            text-align: right;
            border-bottom: 1px solid #dee2e6;
        }

        .table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #495057;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-paid { background: #d4edda; color: #155724; }
        .status-pending { background: #fff3cd; color: #856404; }
        .status-overdue { background: #f8d7da; color: #721c24; }

        @media (max-width: 768px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .dashboard-header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-header">
        <h1>ğŸ“Š ØªØ­Ù„ÙŠÙ„Ø§Øª Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</h1>
        <p>ØªØ­Ù„ÙŠÙ„ Ø´Ø§Ù…Ù„ Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª ÙˆØ§Ù„Ø¹Ù…Ù„Ø§Ø¡</p>
    </div>

    <div class="top-metrics">
        <div class="metric-card">
            <div class="metric-icon">ğŸ’°</div>
            <div class="metric-value" id="total-sales">35000</div>
            <div class="metric-label">Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ø´Ø±ÙƒØ©</div>
            <div class="metric-change positive">+14%</div>
        </div>
        
        <div class="metric-card">
            <div class="metric-icon">ğŸ“‹</div>
            <div class="metric-value" id="invoice-count">350</div>
            <div class="metric-label">Ø¹Ø¯Ø¯ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¬Ù‡Ø§Ø²</div>
            <div class="metric-change positive">+22%</div>
        </div>
        
        <div class="metric-card">
            <div class="metric-icon">ğŸ“ˆ</div>
            <div class="metric-value" id="avg-order">350</div>
            <div class="metric-label">Ù…ØªÙˆØ³Ø· Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¬Ù‡Ø§Ø²</div>
            <div class="metric-change negative">-13%</div>
        </div>
        
        <div class="metric-card">
            <div class="metric-icon">ğŸ¯</div>
            <div class="metric-value" id="conversion-rate">35</div>
            <div class="metric-label">Ø¢Ø®Ø± Ø§Ù„Ø´Ø±ÙƒØ©</div>
            <div class="metric-change positive">+8%</div>
        </div>
    </div>

    <div class="charts-grid">
        <div class="chart-card">
            <div class="chart-title">ğŸ“Š Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</div>
            <canvas id="monthlySalesChart" width="400" height="300"></canvas>
        </div>
        
        <div class="chart-card">
            <div class="chart-title">ğŸ”„ Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ ÙˆØ§Ù„Ø§Ø³ØªØ­ÙˆØ§Ø° Ù„Ù„Ù…ÙˆØ¸ÙÙŠÙ†</div>
            <div style="display: flex; justify-content: center; align-items: center; height: 200px;">
                <canvas id="retentionChart" width="200" height="200"></canvas>
            </div>
            <div style="text-align: center; margin-top: 15px;">
                <div style="margin-bottom: 10px;">
                    <span style="color: #ff4444;">â—</span> Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø§Ø­ØªÙØ§Ø¸: <strong>85%</strong>
                </div>
                <div>
                    <span style="color: #cccccc;">â—</span> Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø§Ø³ØªØ­ÙˆØ§Ø°: <strong>15%</strong>
                </div>
            </div>
        </div>
    </div>

    <div class="chart-card full-width-chart">
        <div class="chart-title">ğŸ“ˆ Ø§ØªØ¬Ø§Ù‡Ø§Øª Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø´Ø±Ø§Ø¡ Ù„ÙØ¦Ø© Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø± Ø¨Ø§Ù„Ø£Ø³Ù‡Ù…</div>
        <canvas id="investmentTrendsChart" width="800" height="300"></canvas>
    </div>

    <div class="performance-indicators">
        <div class="indicator-card">
            <div class="indicator-value">75%</div>
            <div class="indicator-label">Ù…Ø¤Ø´Ø± Ø§Ù„Ø£Ø¯Ø§Ø¡</div>
        </div>
        <div class="indicator-card">
            <div class="indicator-value">30</div>
            <div class="indicator-label">Ø·Ù„Ø¨ Ø´Ø±Ø§Ø¡</div>
        </div>
        <div class="indicator-card">
            <div class="indicator-value">30</div>
            <div class="indicator-label">Ø·Ù„Ø¨ Ø´Ø±Ø§Ø¡</div>
        </div>
        <div class="indicator-card">
            <div class="indicator-value">1</div>
            <div class="indicator-label">Ø·Ù„Ø¨ Ø´Ø±Ø§Ø¡</div>
        </div>
    </div>

    <div class="sales-table">
        <div class="chart-title">ğŸ“‹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ§Ù„ØªØ­ØµÙŠÙ„ Ø§Ù„Ø¬Ø§Ø±ÙŠ</div>
        <table class="table">
            <thead>
                <tr>
                    <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                    <th>ÙˆÙ‚Øª Ø§Ù„Ø¯ÙØ¹</th>
                    <th>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</th>
                    <th>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø³ØªØ­Ù‚</th>
                    <th>Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©</th>
                    <th>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
                    <th>Ù…</th>
                </tr>
            </thead>
            <tbody id="sales-table-body">
                <tr>
                    <td><span class="status-badge status-paid">Ù…Ø¯ÙÙˆØ¹</span></td>
                    <td>2024/01/15</td>
                    <td>Ù†Ù‚Ø¯ÙŠ</td>
                    <td>â‚ª 1,500</td>
                    <td>INV-001</td>
                    <td>Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯</td>
                    <td>1</td>
                </tr>
                <tr>
                    <td><span class="status-badge status-pending">Ù…Ø¹Ù„Ù‚</span></td>
                    <td>2024/01/14</td>
                    <td>ØªØ­ÙˆÙŠÙ„</td>
                    <td>â‚ª 2,300</td>
                    <td>INV-002</td>
                    <td>ÙØ§Ø·Ù…Ø© Ø£Ø­Ù…Ø¯</td>
                    <td>2</td>
                </tr>
                <tr>
                    <td><span class="status-badge status-overdue">Ù…ØªØ£Ø®Ø±</span></td>
                    <td>2024/01/13</td>
                    <td>Ø´ÙŠÙƒ</td>
                    <td>â‚ª 850</td>
                    <td>INV-003</td>
                    <td>Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ</td>
                    <td>3</td>
                </tr>
            </tbody>
        </table>
    </div>

    <script>
        // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ­Ù„ÙŠÙ„Ø§Øª Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª
        async function loadSalesAnalytics() {
            try {
                const response = await fetch('/api/method/financial_dashboard_final.financial_dashboard_final.api.get_sales_analytics');
                const data = await response.json();
                
                if (data.message && data.message.status === 'success') {
                    updateSalesMetrics(data.message.metrics);
                    updateSalesCharts(data.message.charts);
                    updateSalesTable(data.message.sales_data);
                } else {
                    console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', data);
                    loadFallbackSalesData();
                }
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„:', error);
                loadFallbackSalesData();
            }
        }

        function updateSalesMetrics(metrics) {
            document.getElementById('total-sales').textContent = metrics.total_sales || '35000';
            document.getElementById('invoice-count').textContent = metrics.invoice_count || '350';
            document.getElementById('avg-order').textContent = metrics.avg_order || '350';
            document.getElementById('conversion-rate').textContent = metrics.conversion_rate || '35';
        }

        function updateSalesCharts(chartData) {
            // Ø±Ø³Ù… Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ©
            const monthlySalesCtx = document.getElementById('monthlySalesChart').getContext('2d');
            new Chart(monthlySalesCtx, {
                type: 'bar',
                data: {
                    labels: ['1/1', '1/2', '1/3', '1/4', '1/5', '1/6', '1/7', '1/8', '1/9', '1/10', '1/11', '1/12'],
                    datasets: [
                        {
                            label: 'Ù…Ø¨ÙŠØ¹Ø§Øª',
                            data: [400000, 350000, 420000, 380000, 450000, 390000, 410000, 430000, 370000, 460000, 440000, 480000],
                            backgroundColor: '#ff4444'
                        },
                        {
                            label: 'Ù…Ø±ØªØ¬Ø¹Ø§Øª',
                            data: [50000, 40000, 60000, 45000, 55000, 48000, 52000, 58000, 42000, 62000, 59000, 65000],
                            backgroundColor: '#cccccc'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            // Ø±Ø³Ù… Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø§Ø­ØªÙØ§Ø¸
            const retentionCtx = document.getElementById('retentionChart').getContext('2d');
            new Chart(retentionCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø§Ø­ØªÙØ§Ø¸', 'Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø§Ø³ØªØ­ÙˆØ§Ø°'],
                    datasets: [{
                        data: [85, 15],
                        backgroundColor: ['#ff4444', '#cccccc'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });

            // Ø±Ø³Ù… Ø§ØªØ¬Ø§Ù‡Ø§Øª Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±
            const investmentCtx = document.getElementById('investmentTrendsChart').getContext('2d');
            new Chart(investmentCtx, {
                type: 'line',
                data: {
                    labels: ['ÙŠÙ†Ø§ÙŠØ±', 'ÙØ¨Ø±Ø§ÙŠØ±', 'Ù…Ø§Ø±Ø³', 'Ø£Ø¨Ø±ÙŠÙ„', 'Ù…Ø§ÙŠÙˆ', 'ÙŠÙˆÙ†ÙŠÙˆ', 'ÙŠÙˆÙ„ÙŠÙˆ', 'Ø£ØºØ³Ø·Ø³', 'Ø³Ø¨ØªÙ…Ø¨Ø±', 'Ø£ÙƒØªÙˆØ¨Ø±', 'Ù†ÙˆÙÙ…Ø¨Ø±', 'Ø¯ÙŠØ³Ù…Ø¨Ø±'],
                    datasets: [{
                        label: 'Ø§ØªØ¬Ø§Ù‡Ø§Øª Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±',
                        data: [0.8, 0.75, 0.7, 0.65, 0.6, 0.55, 0.5, 0.45, 0.4, 0.35, 0.3, 0.25],
                        borderColor: '#ff4444',
                        backgroundColor: 'rgba(255, 68, 68, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 1
                        }
                    }
                }
            });
        }

        function updateSalesTable(salesData) {
            // ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©
            if (salesData && salesData.length > 0) {
                const tbody = document.getElementById('sales-table-body');
                tbody.innerHTML = '';
                
                salesData.forEach((sale, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td><span class="status-badge status-${sale.status}">${sale.status_label}</span></td>
                        <td>${sale.payment_date}</td>
                        <td>${sale.payment_method}</td>
                        <td>â‚ª ${sale.amount}</td>
                        <td>${sale.invoice_number}</td>
                        <td>${sale.customer_name}</td>
                        <td>${index + 1}</td>
                    `;
                    tbody.appendChild(row);
                });
            }
        }

        function loadFallbackSalesData() {
            // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
            updateSalesMetrics({
                total_sales: '35000',
                invoice_count: '350',
                avg_order: '350',
                conversion_rate: '35'
            });
            
            updateSalesCharts({});
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', loadSalesAnalytics);
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙƒÙ„ 5 Ø¯Ù‚Ø§Ø¦Ù‚
        setInterval(loadSalesAnalytics, 5 * 60 * 1000);
    </script>
</body>
</html>